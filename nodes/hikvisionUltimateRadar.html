<script type="text/javascript">
	RED.nodes.registerType('hikvisionUltimateRadar', {
		category: 'Hikvision Ultimate',
		color: '#C0C0C0',
		defaults: {
			name: { value: "" },
			topic: { value: "" },
			server: { type: "Hikvision-config", required: true },
			filterzone: { value: "0" },
			alarmfilterduration: { value: 0 },
			alarmfilterperiod: { value: 0 }
		},
		inputs: 0,
		outputs: 2,
		outputLabels: function (i) {
			var ret = "";
			switch (i) {
				case 0:
					return "Payload";
					break;
				case 1:
					return "Error";
					break;
				default:
					break;
			}
		},
		icon: "node-radar-icon.png",
		label:
			function () {
				var label = "hikvisionUltimateRadar"
				if (this.name !== undefined && this.name.length > 0) {
					label = this.name;
				}
				return label;
			},
		paletteLabel: function () {
			return "Radar alarm";
		},
		oneditprepare: function () {

			var node = this;

			// 15/01/2021 Hide parts of the ui
			// ##########################################################
			if (node.alarmfilterduration === 0) {
				$("#ui_alarmfilterperiod").hide();
			} else {
				$("#ui_alarmfilterperiod").show();
			}
			$("#node-input-alarmfilterduration").change(function (e) {
				if ($("#node-input-alarmfilterduration").val() == 0) {
					$("#ui_alarmfilterperiod").hide();
				} else {
					$("#ui_alarmfilterperiod").show();
				}
			});
			// ##########################################################

		},
		oneditsave: function () {

		}
	});


</script>

<script type="text/x-red" data-template-name="hikvisionUltimateRadar">
	<div class="form-row">
		<b>Radar node</b>&nbsp&nbsp&nbsp&nbsp<span style="color:red"><i class="fa fa-question-circle"></i>&nbsp<a target="_blank" href="https://github.com/Supergiovane/node-red-contrib-hikvision-ultimate"><u>Help online</u></a></span>
        <br/>
		<br/>

		<label for="node-input-server">Server</label>
		<input type="text" id="node-input-server" />
	</div>
	<div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
	<div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> Node topic</label>
        <input type="text" id="node-input-topic" placeholder="Node's own topic">
	</div>
	<div class="form-row">
        <label for="node-input-filterzone"><i class="fa fa-tasks"></i> React to</label>
		<select id="node-input-filterzone">
			<option value="0">All zones</option>
			<option value="1">Zone 1</option>
			<option value="2">Zone 2</option>
			<option value="3">Zone 3</option>
			<option value="4">Zone 4</option>
			<option value="5">Zone 5</option>
			<option value="6">Zone 6</option>
			<option value="7">Zone 7</option>
			<option value="8">Zone 8</option>
			<option value="9">Zone 9</option>
			<option value="10">Zone 10</option>
			<option value="11">Zone 11</option>
			<option value="12">Zone 12</option>
			<option value="13">Zone 13</option>
			<option value="14">Zone 14</option>
			<option value="15">Zone 15</option>
			<option value="16">Zone 16</option>
		</select>
	</div>
	<br/>
	<div class="form-row">
		<i class="fa fa-filter"></i>&nbsp&nbsp<b>False alarms filtering options</b>
		<br/>	<br/>
        <label for="node-input-alarmfilterduration"><i class="fa fa-tasks"></i> Alarm duration</label>
		<select id="node-input-alarmfilterduration">
			<option value=0>No wait. Immediate alarm.</option>
			<option value=1>more than 1 Second</option>
			<option value=2>more than 2 Seconds</option>
			<option value=3>more than 3 Seconds</option>
			<option value=4>more than 4 Seconds</option>
			<option value=5>more than 5 Seconds</option>
			<option value=6>more than 6 Seconds</option>
			<option value=7>more than 7 Seconds</option>
			<option value=8>more than 8 Seconds</option>
			<option value=9>more than 9 Seconds</option>
			<option value=10>more than 10 Seconds</option>
			<option value=11>more than 11 Seconds</option>
			<option value=12>more than 12 Seconds</option>
			<option value=13>more than 13 Seconds</option>
			<option value=14>more than 14 Seconds</option>
			<option value=15>more than 15 Seconds</option>
			<option value=16>more than 16 Seconds</option
			<option value=17>more than 17 Seconds</option>
			<option value=18>more than 18 Seconds</option>
			<option value=19>more than 19 Seconds</option>
			<option value=20>more than 20 Seconds</option>
		</select>
	</div>
	<div class="form-row" id="ui_alarmfilterperiod">
		<label for="node-input-alarmfilterperiod"><i class="fa fa-tasks"></i> Evaluation period</label>
		<select id="node-input-alarmfilterperiod">
			<option value=1>1 Second</option>
			<option value=2>2 Seconds</option>
			<option value=3>3 Seconds</option>
			<option value=4>4 Seconds</option>
			<option value=5>5 Seconds</option>
			<option value=6>6 Seconds</option>
			<option value=7>7 Seconds</option>
			<option value=8>8 Seconds</option>
			<option value=9>9 Seconds</option>
			<option value=10>10 Seconds</option>
			<option value=11>11 Seconds</option>
			<option value=12>12 Seconds</option>
			<option value=13>13 Seconds</option>
			<option value=14>14 Seconds</option>
			<option value=15>15 Seconds</option>
			<option value=16>16 Seconds</option
			<option value=17>17 Seconds</option>
			<option value=18>18 Seconds</option>
			<option value=19>19 Seconds</option>
			<option value=20>20 Seconds</option>
			<option value=21>21 Seconds</option>
			<option value=22>22 Seconds</option>
			<option value=23>23 Seconds</option>
			<option value=24>24 Seconds</option>
			<option value=25>25 Seconds</option>
			<option value=26>26 Seconds</option>
			<option value=27>27 Seconds</option>
			<option value=28>28 Seconds</option>
			<option value=29>29 Seconds</option>
			<option value=30>30 Seconds</option>
		</select>
		<div class="form-tips" style="margin-top:11px">
		Above options: the node will emit an alarm msg only if the alarm persists (remains TRUE) or repeats (in this case, the persisting time of each TRUE value is evaluated) for the time specified in "Alarm duration", during the "Evaluation period".
		</div>
	</div>

</script>

<script type="text/x-red" data-help-name="hikvisionUltimateRadar">
	<p>
        <a href="https://www.paypal.me/techtoday" target="_blank"><img src='https://img.shields.io/badge/Donate-PayPal-blue.svg?style=flat-square' width='30%'></a>
        
	</p>
	<p>
		The node outputs true/false on PIN 1and a connection ERROR on PIN 2 (true if the node is DISCONNECTED to the server, otherwise false IF IT'S RECONNECTED).
	</p>
	
</script>